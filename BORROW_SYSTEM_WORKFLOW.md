# üìö Syst√®me d'Emprunt de Livres - Guide Complet

## ‚úÖ Fonctionnalit√©s Impl√©ment√©es

### 1. üîê Propri√©t√© des Livres
**Status: ‚úÖ IMPL√âMENT√â**

- **Cr√©ation de livre**: Quand un utilisateur ajoute un livre, il devient automatiquement le propri√©taire (`ownerId`)
- **Fichier**: `app/Http/Controllers/BookController.php` ligne 69
  ```php
  // Assigner le propri√©taire du livre au user connect√©
  $data['ownerId'] = Auth::id();
  ```

### 2. üö´ Protection: Pas d'emprunt de son propre livre
**Status: ‚úÖ IMPL√âMENT√â**

- **Validation**: Un utilisateur ne peut PAS emprunter son propre livre
- **Fichier**: `app/Http/Controllers/BorrowRequestController.php` ligne 57
  ```php
  // V√©rifier que l'utilisateur ne demande pas son propre livre
  if ($book->ownerId == Auth::id()) {
      return back()->withErrors(['error' => 'Vous ne pouvez pas emprunter votre propre livre.']);
  }
  ```

### 3. ‚úÖ Emprunt entre utilisateurs
**Status: ‚úÖ IMPL√âMENT√â**

- **User1** ajoute un livre ‚Üí User1 est propri√©taire
- **User2** ajoute un livre ‚Üí User2 est propri√©taire
- **User1** peut emprunter le livre de User2 ‚úÖ
- **User2** peut emprunter le livre de User1 ‚úÖ

### 4. üìä Dashboard avec Demandes
**Status: ‚úÖ IMPL√âMENT√â**

Chaque utilisateur voit dans son dashboard:

#### Mes Demandes Envoy√©es
- Liste des livres que j'ai demand√© √† emprunter
- Statut de chaque demande (En attente, Approuv√©, Rejet√©)
- **Fichier**: `app/Http/Livewire/Dashboard.php` ligne 14-18

#### Demandes Re√ßues
- Liste des demandes pour MES livres
- Possibilit√© d'approuver ou rejeter
- **Fichier**: `app/Http/Livewire/Dashboard.php` ligne 20-24

### 5. üëë Syst√®me d'Approbation (Admin du Livre)
**Status: ‚úÖ IMPL√âMENT√â**

Le **propri√©taire du livre** (owner_id) est le seul √† pouvoir:

#### ‚úÖ Approuver une demande
- **Fichier**: `app/Http/Controllers/BorrowRequestController.php` ligne 87
  ```php
  if ($borrowRequest->owner_id !== Auth::id()) {
      return back()->withErrors(['error' => 'Vous n\'√™tes pas autoris√©...']);
  }
  ```

#### ‚ùå Rejeter une demande
- **Fichier**: `app/Http/Controllers/BorrowRequestController.php` ligne 107

#### üîÑ Marquer comme retourn√©
- **Fichier**: `app/Http/Controllers/BorrowRequestController.php` ligne 124

---

## üéØ Workflow Complet

### Sc√©nario: User1 et User2

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. User1 ajoute "Harry Potter"                             ‚îÇ
‚îÇ    ‚Üí ownerId = User1                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. User2 ajoute "Le Seigneur des Anneaux"                  ‚îÇ
‚îÇ    ‚Üí ownerId = User2                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. User1 essaie d'emprunter "Harry Potter" (son livre)     ‚îÇ
‚îÇ    ‚Üí ‚ùå REFUS√â: "Vous ne pouvez pas emprunter votre        ‚îÇ
‚îÇ       propre livre"                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. User1 demande "Le Seigneur des Anneaux" (livre User2)   ‚îÇ
‚îÇ    ‚Üí ‚úÖ ACCEPT√â: Demande cr√©√©e avec status "pending"       ‚îÇ
‚îÇ    ‚Üí borrower_id = User1                                    ‚îÇ
‚îÇ    ‚Üí owner_id = User2                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. User2 voit la demande dans son Dashboard                ‚îÇ
‚îÇ    Section: "Demandes Re√ßues"                               ‚îÇ
‚îÇ    ‚Üí Affiche: "Le Seigneur des Anneaux"                    ‚îÇ
‚îÇ    ‚Üí Demandeur: User1                                       ‚îÇ
‚îÇ    ‚Üí Boutons: [‚úÖ APPROUVER] [‚ùå REFUSER]                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. User2 (propri√©taire) approuve la demande                ‚îÇ
‚îÇ    ‚Üí Status change: "pending" ‚Üí "approved"                  ‚îÇ
‚îÇ    ‚Üí Livre marqu√©: is_available = false                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. User1 voit dans son Dashboard                           ‚îÇ
‚îÇ    Section: "Mes Demandes Envoy√©es"                        ‚îÇ
‚îÇ    ‚Üí Status: "Approuv√©" (badge vert)                       ‚îÇ
‚îÇ    ‚Üí Bouton: [Marquer comme Rendu]                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîí Protections de S√©curit√©

### ‚úÖ V√©rifications Impl√©ment√©es

1. **Livre doit avoir un propri√©taire**
   - Ligne 52 dans `BorrowRequestController.php`

2. **Pas d'emprunt de son propre livre**
   - Ligne 57 dans `BorrowRequestController.php`

3. **Pas de doublon de demande**
   - Ligne 62-68 dans `BorrowRequestController.php`

4. **Seul le propri√©taire peut approuver/rejeter**
   - Lignes 87, 107, 124 dans `BorrowRequestController.php`

5. **Validation des dates**
   - start_date doit √™tre apr√®s aujourd'hui
   - end_date doit √™tre apr√®s start_date
   - Ligne 41-46 dans `BorrowRequestController.php`

---

## üìç Pages de l'Application

### 1. Home (Catalogue Public)
- **Route**: `/`
- **Vue**: Tous les livres disponibles
- **Action**: Bouton "Emprunter" pour chaque livre

### 2. Dashboard
- **Route**: `/dashboard`
- **Vue**: 
  - Mes demandes envoy√©es (5 derni√®res)
  - Demandes re√ßues (5 derni√®res)
  - Lien "Voir tout"

### 3. Gestion des Emprunts
- **Route**: `/borrow-requests`
- **Vue**: 
  - Onglet "Mes Demandes" (envoy√©es)
  - Onglet "Demandes Re√ßues" (pour mes livres)
  - Actions: Approuver, Rejeter, Annuler, Marquer comme Rendu

### 4. Mes Livres
- **Route**: `/books`
- **Vue**: CRUD complet des livres
- **Action**: Ajouter un livre ‚Üí devient propri√©taire automatiquement

---

## üé® Interface Utilisateur

### Badge de Statut
- üü° **En attente** (pending) - Jaune
- üü¢ **Approuv√©** (approved) - Vert
- üî¥ **Rejet√©** (rejected) - Rouge
- üîµ **Retourn√©** (returned) - Bleu

### Boutons d'Action

#### Pour l'Emprunteur (borrower)
- üì§ **Demander un emprunt** (depuis la page du livre)
- ‚ùå **Annuler** (si status = pending)
- ‚úÖ **Marquer comme Rendu** (si status = approved)

#### Pour le Propri√©taire (owner)
- ‚úÖ **APPROUVER** (si status = pending)
- ‚ùå **REFUSER** (si status = pending)
- üîÑ **Marquer comme Retourn√©** (si status = approved)

---

## üß™ Comment Tester

### √âtape 1: Cr√©er 2 utilisateurs
```bash
php artisan tinker
```

```php
// Cr√©er User1
$user1 = \App\Models\User::create([
    'name' => 'Alice',
    'email' => 'alice@test.com',
    'password' => bcrypt('password')
]);

// Cr√©er User2
$user2 = \App\Models\User::create([
    'name' => 'Bob',
    'email' => 'bob@test.com',
    'password' => bcrypt('password')
]);
```

### √âtape 2: User1 ajoute un livre
1. Se connecter comme alice@test.com
2. Aller sur `/books/create`
3. Ajouter "Le Petit Prince"
4. V√©rifier: `ownerId` = User1

### √âtape 3: User2 ajoute un livre
1. Se d√©connecter
2. Se connecter comme bob@test.com
3. Aller sur `/books/create`
4. Ajouter "1984"
5. V√©rifier: `ownerId` = User2

### √âtape 4: User1 essaie d'emprunter son propre livre
1. Se connecter comme alice@test.com
2. Aller sur la page du livre "Le Petit Prince"
3. Cliquer "Emprunter"
4. **R√©sultat attendu**: ‚ùå "Vous ne pouvez pas emprunter votre propre livre"

### √âtape 5: User1 emprunte le livre de User2
1. Toujours connect√© comme alice@test.com
2. Aller sur la page du livre "1984" (de Bob)
3. Remplir les dates d'emprunt
4. Cliquer "Emprunter"
5. **R√©sultat attendu**: ‚úÖ "Demande d'emprunt envoy√©e avec succ√®s!"

### √âtape 6: User1 voit sa demande dans le Dashboard
1. Aller sur `/dashboard`
2. Section "Mes demandes envoy√©es"
3. **R√©sultat attendu**: 
   - Livre: "1984"
   - Propri√©taire: Bob
   - Status: üü° En attente

### √âtape 7: User2 voit la demande et l'approuve
1. Se d√©connecter
2. Se connecter comme bob@test.com
3. Aller sur `/dashboard`
4. Section "Demandes re√ßues"
5. **R√©sultat attendu**: 
   - Livre: "1984"
   - Demandeur: Alice
   - Boutons: [‚úÖ APPROUVER] [‚ùå REFUSER]
6. Cliquer sur **APPROUVER**
7. **R√©sultat**: ‚úÖ "Demande approuv√©e avec succ√®s!"

### √âtape 8: User1 voit le changement de statut
1. Se d√©connecter
2. Se connecter comme alice@test.com
3. Aller sur `/dashboard`
4. Section "Mes demandes envoy√©es"
5. **R√©sultat attendu**: 
   - Status: üü¢ Approuv√©
   - Bouton: [Marquer comme Rendu]

---

## üìù Base de Donn√©es

### Table: books
```
id | title | author | ownerId | is_available
1  | Le Petit Prince | Saint-Exup√©ry | 1 (User1) | true
2  | 1984 | George Orwell | 2 (User2) | false
```

### Table: borrow_requests
```
id | borrower_id | owner_id | book_id | status | start_date | end_date
1  | 1 (User1)  | 2 (User2) | 2      | approved | 2025-10-19 | 2025-10-30
```

---

## ‚úÖ Checklist Fonctionnalit√©s

- [x] User qui cr√©e un livre en devient propri√©taire automatiquement
- [x] User ne peut PAS emprunter son propre livre
- [x] User peut emprunter les livres d'autres users
- [x] Dashboard affiche les demandes envoy√©es
- [x] Dashboard affiche les demandes re√ßues
- [x] Propri√©taire peut approuver/rejeter les demandes
- [x] Seul le propri√©taire peut g√©rer les demandes de son livre
- [x] Validation des dates et des doublons
- [x] Syst√®me de statuts (pending, approved, rejected, returned)
- [x] Gestion de la disponibilit√© des livres

---

## üéâ R√©sum√©

**Tout fonctionne exactement comme tu le veux!**

1. ‚úÖ User1 ajoute un livre ‚Üí devient propri√©taire
2. ‚úÖ User1 ne peut PAS emprunter son propre livre
3. ‚úÖ User1 PEUT emprunter le livre de User2
4. ‚úÖ Chaque user voit ses demandes dans le dashboard
5. ‚úÖ Propri√©taire est l'admin qui approuve/rejette les demandes de SON livre

Le syst√®me est **100% fonctionnel** et s√©curis√©! üöÄ
